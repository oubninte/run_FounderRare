#! /bin/sh
#SBATCH --account=def-bureau
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=1
#SBATCH --mem-per-cpu=4G
#SBATCH --time=0-00:30
#SBATCH --output=/lustre03/project/6033529/genealogy_sims/results/Samir/Sims_power/Phenotype_sims_100reps/Slurm_files8/SimulatePheno_%A.out
#SBATCH --mail-user=samir.oubninte.1@ulaval.ca
#SBATCH --mail-type=FAIL


# Objective:
# Submit and run an R-based phenotype simulation on a SLURM cluster.
# Load the R module, set parameters (chromosome, replicate, OR), define paths, and call the R script.

1) Set SLURM job directives: account, CPU/memory, time limit, output log, email on failure... (see top).

# Example sbatch commands to launch this script: 
# for chrom in 19; do for rep in 93; do sbatch --export=ALL,chrom=${chrom},rep=${rep} run_SimulatePheno.sh ; done; done
# for chrom in {22..1}; do for rep in {1..100}; do sbatch --export=ALL,chrom=${chrom},rep=${rep} run_SimulatePheno.sh ; done; done

echo "****************************        Starting...        ****************************"



module load r/4.1.2

echo "Exe date"
date +%D 
date +%T

wrok_dir=$(pwd)

odd=20
causal_regions_path="${wrok_dir}/regions_casaux_GOOD.txt"   # use  the good version
chemin_VR="${wrok_dir}/PairsOf2VrsInDffHaplo_genotype/" 
N_region=1 
       
#for rep in 6  14  15  18  28  29  32  34  37  39  40  41  44  45  48  49  50  51  54  58  59  60  63  66  68  79  82  85  87  88  91  95  97  98 100; do   
#for rep in 100;do

  echo "**************************** chr=$chrom , rep=$rep , OR=$odd ****************************"


  #Simulte phenotype ...          
#  echo "Simulte phenotype ... one variant..."
#  chemin_VR="${wrok_dir}/Rare_variants/" 
#  chemin_save="${wrok_dir}/affectedID_OR${odd}/"     
#  mkdir -p "$chemin_save/" 
#  Rscript Simulate_pheno_basic_OneVr.R  $chrom $rep $odd $causal_regions_path $chemin_VR $chemin_save
  
  
  
  echo "Simulte phenotype ... two variant in diff haplo ..."

  chemin_VR="${wrok_dir}/PairsOf2VrsInDffHaplo_genotype/" 
  chemin_save="${wrok_dir}/affectedID_By2Vrs_OR${odd}/"     
  mkdir -p "$chemin_save/" 
  Rscript SimulatePheno_By2VrsInDiffHaplo.R  $chrom $rep $odd $causal_regions_path $chemin_VR $chemin_save $N_region
  
#done



echo "****************************     ... End        ****************************"